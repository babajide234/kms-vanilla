<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="style.css" type="text/css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tiny.cloud/1/50wdqgqz88fpl68n52tmf8ilkr5udtv1jwcbcymq1f2xe9bo/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

    <script>
  
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#991313",
              bgsecond: "#f1efef",
              text: "#3a3737",
              textsub: "#9a9898",
              border: "#c2bdbd",
              hemp: "#8a7474",
              accent1: "#c39494",
              accent2: "#cdacac",
              sirocco: "#6c7474",
            }
          }
        }
      }
  
      lucide.createIcons();
  
    </script>
</head>
<body>
    <div class="flex w-full h-screen overflow-y-hidden">
        <div id="sidebar" class="w-[20%] h-full bg-bgsecond pt-24 hidden md:block">
            <div class=" absolute top-5 left-5 flex gap-2 items-center text-white">
                <div class="">
                    <img src="./img/logo.png" alt="" class=" w-8  ">
                </div>
                <div class="">
                    <h2 class=" font-bold text-sm text-primary">Custodian</h2>
                    <p class=" text-textsub text-xs">Knowledge management System</p>
                </div>
            </div>
            <div class=" py-5">
                <div class="dropdown flex w-[80%] mx-auto rounded-lg flex-col  bg-white relative z-0">
                    <a href="./content.html" class="flex text-primary items-center px-2.5 py-[15px] rounded-lg gap-4 text-sm font-medium">
                        <span class="">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                        </span>
                        Create new content
                    </a>
                </div>
            </div>
        </div>
        <div class=" flex-1 overflow-y-scroll flex flex-col">
            <div class="article-header p-8 flex items-center justify-between   border-solid border-gray-300">
                <div class=" flex items-center gap-[30px]">
                    <a href="/dashboard.html" class=" bg-[#F5F5F5] w-[48px] h-[48px] rounded-full flex justify-center items-center " type="">
                        <i class="">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M20 12H4M4 12L10 18M4 12L10 6" stroke="#900000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </i>
                    </a>
                    <h2 class=" text-[26px] font-bold" id="txtTitle"></h2>
                </div>
                <div class="flex items-center gap-5">
                    <button onclick="sharetoggle()" class="py-[8px] px-[14px] bg-[#900000] capitalize text-sm rounded-lg text-white font-semibold ">Share</button>
                    <button class="py-2 px-2  rounded-lg hover:bg-gray-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M8 12L12 16M12 16L16 12M12 16V8M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="#3F3F3F" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button class="py-2 px-2  rounded-lg hover:bg-gray-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M5 7.8C5 6.11984 5 5.27976 5.32698 4.63803C5.6146 4.07354 6.07354 3.6146 6.63803 3.32698C7.27976 3 8.11984 3 9.8 3H14.2C15.8802 3 16.7202 3 17.362 3.32698C17.9265 3.6146 18.3854 4.07354 18.673 4.63803C19 5.27976 19 6.11984 19 7.8V21L12 17L5 21V7.8Z" stroke="#3F3F3F" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <!-- <button class="py-2 px-2  rounded-lg hover:bg-gray-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z" stroke="#3F3F3F" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12C18 12.5523 18.4477 13 19 13Z" stroke="#3F3F3F" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13Z" stroke="#3F3F3F" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button> -->
                    <button class="dock-toggle py-2 px-2  rounded-lg hover:bg-gray-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" class="rotate-svg transition-transform ease duration-300">
                            <path d="M6 17L11 12L6 7M13 17L18 12L13 7" stroke="black" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class=" flex">
                <div class=" document-content flex-1 min-h-screen p-8 relative ">
                    <div class=" mb-3">
                        <h2 class=" mb-3 text-md font-semibold capitalize">Description</h2>
                        <p class="text-[#808080] text-sm" id="txtDescription">

                        </p>
                    </div>
                    <div class="">
                        <h2 class="mb-3 text-md font-semibold capitalize">content</h2>
                        <div class="" id="display-content"></div>                        
                    </div>
                </div>
                <div id="dock" class=" document-dock tab-container hidden  w-[253px] border-l border-gray-300 border-solid min-h-screen ">
                    <div class=" flex gap-5 px-[10px] py-[15px] items-center border-b border-gray-300 border-solid">
                        <button class="">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="17" viewBox="0 0 16 17" fill="none">
                                <path d="M14 14.5L11.1 11.6M12.6667 7.83333C12.6667 10.7789 10.2789 13.1667 7.33333 13.1667C4.38781 13.1667 2 10.7789 2 7.83333C2 4.88781 4.38781 2.5 7.33333 2.5C10.2789 2.5 12.6667 4.88781 12.6667 7.83333Z" stroke="#808080" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="tab-btn text-[12px]  text-textsub font-semibold " data-tab="remarks">Remarks</button>
                        <button class="tab-btn text-[12px]  text-textsub font-semibold " data-tab="requestUpdate">Reviews and comments</button>
                    </div>
                    <div class="remarks-tab tab-content">
                        <div class=" py-3 px-[10px] border-b border-gray-300 border-solid flex items-center justify-between ">
                            <h3 class=" text-[12px] text-text font-semibold ">Like</h3>
                            <button id="likeForm" class="flex text-gray-300 ">
                                <svg 
                                    xmlns="http://www.w3.org/2000/svg" 
                                    viewBox="0 0 16 17" 
                                    stroke-width="0" 
                                    stroke="currentColor" 
                                    fill="currentColor" 
                                    class="w-5 h-5"                                
                                >
                                    <path d="M4.66683 15.1668V7.8335M1.3335 9.16683V13.8335C1.3335 14.5699 1.93045 15.1668 2.66683 15.1668H11.6177C12.6048 15.1668 13.4443 14.4466 13.5944 13.4709L14.3124 8.80428C14.4987 7.59276 13.5614 6.50016 12.3356 6.50016H10.0002C9.63197 6.50016 9.3335 6.20169 9.3335 5.8335V3.47739C9.3335 2.56949 8.5975 1.8335 7.6896 1.8335C7.47305 1.8335 7.27682 1.96103 7.18887 2.15891L4.84279 7.43759C4.73579 7.67834 4.49704 7.8335 4.23358 7.8335H2.66683C1.93045 7.8335 1.3335 8.43045 1.3335 9.16683Z" stroke="#808080" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        <div class=" py-3 px-[10px] border-b border-gray-300 border-solid flex items-center justify-between ">
                            <h3 class=" text-[12px] text-text font-semibold ">Rate</h3>
                            <div class="flex gap-2">
                                <div class="rating">
                                    <span class="star hover:cursor-pointer text-gray-300">&#9733;</span>
                                    <span class="star hover:cursor-pointer text-gray-300">&#9733;</span>
                                    <span class="star hover:cursor-pointer text-gray-300">&#9733;</span>
                                    <span class="star hover:cursor-pointer text-gray-300">&#9733;</span>
                                    <span class="star hover:cursor-pointer text-gray-300">&#9733;</span>
                                </div>
                                <p class="result"><span id="rating-value"></span></p>
                            </div>
                        </div>
                        <div class=" py-3 px-[10px] border-b border-gray-300 border-solid flex items-center justify-between ">
                            <div class=" w-full flex flex-col gap-4">
                                <h3 class=" text-[12px] text-text font-semibold ">Documents</h3>
                                <ul class="w-full flex flex-col gap-2" id="ddlDocuments">
                                   
                                </ul>
                                
                            </div>
                        </div>
                        
                    </div>
                    <div class="requestUpdate-tab tab-content">
                        <div class=" py-3 px-[10px] border-b border-gray-300 border-solid flex items-center justify-between ">
                            <div class="">
                                <h3 class=" text-[12px] text-text font-semibold mb-3">Add Comment</h3>
                                <form action="" class="">
                                    <textarea name="" class=" w-full rounded-lg border border-[#DBDBDB] border-solid" id="" cols="30" rows="5"></textarea>
                                    <button class=" text-primary  px-3 py-2 rounded-lg hover:bg-bgsecond float-right">Submit</button>
                                </form>
                            </div>
                        </div>
                        <div class=" py-3 px-[10px] border-b border-gray-300 border-solid flex items-center justify-between ">
                            <div class="w-full">
                                <h3 class=" text-[12px] text-text font-semibold mb-3">Previous comments</h3>
                                
                                <div class=" flex flex-col gap-2 w-full" id="PreviousComments">
            
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div  class="share hidden fixed w-full z-20 h-screen bg-[#808080BF] flex items-center justify-center ">
            <div class="bg-white p-4 w-[600px]  rounded-lg ">
                    <div class=" flex justify-between items-center border-b border-gray-300 py-3">
                        <h2 class=" text-2xl font-semibold">Share</h2>
                        <button onclick="sharetoggle()" class="">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                              </svg>                              
                        </button>
                    </div>
                    <div id="sharemodal" class="tab-container py-5">
                        <div class=" mb-5">
                            <ul class=" flex items-center ">
                                <li data-tab="email" class=" tab-btn text-textsub  py-2 px-2 text-md border-b-2 border-red-800 hover:cursor-pointer">Send as mail</li>
                                <li data-tab="app" class=" tab-btn  text-textsub py-2 px-2 text-md border-b-2 border-red-800 hover:cursor-pointer">Share in-app</li>
                                <li data-tab="link" class=" tab-btn  text-textsub py-2 px-2 text-md border-b-2 border-red-800 hover:cursor-pointer">Generate link</li>
                            </ul>
                        </div>
                        <div class=" email-tab tab-content w-full flex flex-col gap-5 border border-gray-300 rounded-md py-2 flex items-center px-3">
                            <div class=" w-full gap-3 flex items-center border border-solid border-gray-300 p-3 rounded-md">
                                <span class="">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                                      </svg>                                      
                                </span>
                                <input type="text" class=" outline-none flex-grow" placeholder="Add email address" />
                            </div>
                            <div class=" w-full flex items-center justify-between">
                                <p class="text-base text-neutral-700 leading-tight">Person shared with </p>
                                <div class="dropdown relative">
                                    <button data-tag="" class=" flex items-center">
                                      <span class="text max-w-[150px] truncate">can view</span>
                                      <span class="  ">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                              <path d="M5 7.5L10 12.5L15 7.5" stroke="#606060" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                          </svg>
                                      </span>
                                    </button>
                                    <div data-dropdown class=" hidden w-44 h-20 px-5 py-[15px] bg-white flex flex-col text-sm text-[#3F3F3F] gap-[10px] shadow-md absolute top-[3rem] left-0 z-[100] rounded-lg ">
                                          <button data-sub="can view" class="p-1 hover:bg-gray-50 text-left rounded-sm">can view</button>
                                          <button data-sub="can view" class="p-1 hover:bg-gray-50 text-left rounded-sm">can download</button>
                                    </div>
                                </div>
                            </div>
                            <div class=" w-full flex items-center justify-between">
                                <p class="text-base text-neutral-700 leading-tight">Set expiration date</p>
                                <label for="setdate"  class=" hover:cursor-pointer">
                                    <!-- <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
                                    </svg>                                       -->
                                    <input type="date" name="date" class=" " id="setdate">
                                </label>
                            </div>
                            <div class=" w-full flex items-center justify-between">
                                <button onclick="sharetoggle()" class=" text-sm font-semibold text-white bg-primary w-full text-center p-3 rounded-lg">Share</button>
                            </div>
                        </div>
                        <div class=" app-tab tab-content border border-gray-300 rounded-md py-2 flex items-center px-3">
                            app
                        </div>
                        <div class=" link-tab tab-content border border-gray-300 rounded-md py-2 flex items-center px-3">
                            link
                        </div>
                    </div>
                    <div class=" flex justify-end">
                    </div>
            </div>
        </div>
    </div>
    <script src="./common.js"></script>
    <script src="./index.js"></script>
    <script>
        $(document).ready(function(){
            getTop()
            const searchParams = new URLSearchParams(window.location.search);
            const param = searchParams.get('refNo')
            console.log(param);
            if (param != null) {
                getSingleContent(param);
            }
        })

        function getSingleContent(id) 
            {
                const [ContentId, UserName] = id.split("_");

                const requestData = {
                    "ContentId":ContentId,
                    "UserName": UserName.toLowerCase(),
                    "IPAddress": "127.0.0.1:5500"
                };

                makeApiCall(
                    API_ENDPOINTS.GET_CONTENT_BY_ID,
                    "POST",
                    requestData,
                    handleSuccess,
                    handleFailure
                );

                function handleSuccess(response) {
                    console.log(response);

                    if (response.ResponseCode === 100) {
                        updatePageContent(response);
                    }
                }

                function handleFailure(xhr, status, error) {
                    console.error("Error getting content:", status, error);
                    // Handle error as needed
                }

        }

        function updatePageContent(content) {
            var result = content.Result
            $('#txtDescription').text(result.Description);
            $('#txtTitle').text(result.Title);
            // $('#editor').html(quill.clipboard.dangerouslyPasteHTML(0, content.ContentBody));
            $('#PreviousComments').append(PreviousComment(content.Reviews));
            $('#ddlDocuments').html(generateDocumentList(content.ContentDocuments));

            const formattedValue = calculateAverageRating(content.Reviews).toFixed(1);

            $('#rating-value').text(formattedValue);
            const starElements = document.querySelectorAll('.rating span');

            // Dynamically change the color of stars based on the score
            $('.rating span').each((index, star) => {
                $(star).toggleClass('text-yellow-400', index < formattedValue);
            });

            const contentContainer = document.getElementById('display-content');


            if (isNonArticleContentType(result.ContentType)) {
                // Display non-article content HTML
                if (result.ContentType === 'Image') {
                    const imageGallery = generateImageGallery(content.data);
                    contentContainer.innerHTML = imageGallery;
                } else if (result.ContentType === 'Video') {
                    const videoGallery = generateVideoGallery(content.data);
                    contentContainer.innerHTML = videoGallery;
                } else if (result.ContentType === 'Document') {
                    contentContainer.innerHTML = `${result.ContentBody}`;
                }
            } else {
                // Display article HTML
                contentContainer.innerHTML = `${result.ContentBody}`;
            }
        }
        
        function isNonArticleContentType(contentType) {
            console.log("contentType: ",contentType)
            return ["Image", "Document", "Video"].includes(contentType);
        }

        function PreviousComment(reviews) {
            if (reviews.length === 0) {
                return '<p>No reviews available.</p>';
            }

            const commentElements = reviews.map(review => createCommentElement(review));
            const commentsHtml = commentElements.join('');
            return commentsHtml;
        }

        function createCommentElement(review) {
            return `
                <div class="flex flex-col gap-2 w-full">
                    <p class="text-sm text-[#606060] text-justify text-xs">
                        ${review.Comment}
                    </p>
                    <div class=" w-full flex items-center justify-between">
                        <span class=" inline-flex text-primary capitalize text-ellipsis overflow-hidden text-[10px] w-24 break-words">${review.Reviewer}</span>
                        <span class=" inline-flex text-text text-xs">${formatDate(review.ReviewDate)}</span>
                    </div>
                </div>
            `;
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString();
        }

        function generateDocumentList(contentDocuments) {
            if (contentDocuments.length === 0) {
                return '<p class=" text-md text-primary text-center capitalize">No documents.</p>';
            }

            return contentDocuments.map(document => createDocumentLink(document)).join('');
        }

        function createDocumentLink(document) {
            return `
                <a href="${document.url}" class="text-xs text-gray-300 group py-2 px-2 border border-solid border-gray-300 rounded-md hover:border-primary flex justify-between items-center">
                    <span class="group-hover:text-primary">
                        ${document.name}
                    </span>
                    <span class="group-hover:text-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                        </svg>
                    </span>
                </a>
            `;
        }
  
        function generateImageGallery(images) {
            if (!images || images.length === 0) {

                return '<p>No images available.</p>';
            }

            return `
                <div class="grid grid-cols-5 gap-2">
                    ${images.map(image => `
                        <div class="gallery-item hover:cursor-pointer" data-image="${image}">
                            <img src="${image}" alt="" class="">
                        </div>
                    `).join('')}
                </div>
            `;
        }


        function generateVideoGallery(videos) {
            return `
                <div class="grid grid-cols-3 gap-2">
                    ${videos.map((video, i) => `
                        <div class="relative group w-full h-40">
                            <video class="object-fit-cover w-full h-full rounded" controls><source src="${video.src}" type="${video.type}"></video>
                            <button class="absolute top-3 right-3 bg-white text-gray-600 p-1 rounded-full opacity-0 group-hover:opacity-100" data-index="${i}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function calculateAverageRating(reviews) {
            if (reviews.length === 0) {
                return 0; // Return 0 for an empty array or handle it as needed
            }

            const totalRating = reviews.reduce((sum, review) => sum + review.Rating, 0);
            const averageRating = totalRating / reviews.length;

            return averageRating;
        }
        function getTop(){
            

            const requestData = {
                "UserName": "dmsuser1@custodianinsurance.com",
                "IPAddress": "127.0.0.1:5500",
                "FullName":"User1"
            };

            makeApiCall(API_ENDPOINTS.TOP_15_CONTENT, "POST", requestData, function (response) {
                console.log(response);
                
            }, function (xhr, status, error) {
                console.error("Error getting users:", status, error);
                // Handle error as needed
            });
        }
    
       
    
    </script>
</body>
</html>